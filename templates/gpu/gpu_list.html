{% extends 'base.html' %}

{% block title %}{{ gpu.brand }} - {{ gpu.model }}{% endblock %}

{% block content %}

{% load custom_filters %}

<div class="col-sm-12">
  <div class="titleheader">
    <h3 class="h2header text-center">Graphics Card ({{ gpus|length }})</h3>
    <a href="?sort_by=name">A to Z</a>
    <a href="?sort_by=-name">Z to A</a>
  </div>

<!-- <div id="testingcss"> -->
<input type="text" id="gpuSearch" onkeyup="filterGpus()" placeholder="Search GPUs...">
<input type="number" id="minPrice" placeholder="Min Price">
<input type="number" id="maxPrice" placeholder="Max Price">
<button onclick="toggleSort()">Price Sort</button>

<!-- <div class="container"> -->
<div id="gpuList">
  {% for gpu in gpus %}
  <div class="book-wrapper text-center">
    <div class="coverpage">
      <img src="https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL2dyYXBoaWNzLWNhcmQtdXBkYXRlMS5qcGciLCJlZGl0cyI6eyJyZXNpemUiOnsid2lkdGgiOjgyOH19fQ==">
    </div>
    <a href="{% url 'gpu_detail' gpu.pk %}">{{ gpu.name }} - {{ gpu.chipset }}</a>
    <p>{{ gpu.price|convert_to_myr }}</p>
    <button class="select-button" onclick="selectComponent('gpu', '{{ gpu.id }}')">Add</button>
  </div>
  {% endfor %}

<script>
  let sortDirection = 'asc'; // Default sorting direction

  function toggleSort() {
    if (sortDirection === 'asc') {
      sortDirection = 'desc';
    } else {
      sortDirection = 'asc';
    }
    filterGpus(); // Reapply existing filters after sorting
  }

  function filterGpus() {
    var input, filter, minPrice, maxPrice, ul, li, a, i, txtValue, price;
    input = document.getElementById('gpuSearch');
    filter = input.value.toUpperCase();
    minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
    maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;
    ul = document.getElementById('gpuList');
    li = ul.getElementsByClassName('book-wrapper');

    var gpuArray = Array.from(li);

    gpuArray.sort(function(a, b) {
      var priceA = parseFloat(a.querySelector('p').textContent.replace('RM ', ''));
      var priceB = parseFloat(b.querySelector('p').textContent.replace('RM ', ''));

      if (sortDirection === 'asc') {
        return priceA - priceB;
      } else if (sortDirection === 'desc') {
        return priceB - priceA;
      } else {
        return 0;
      }
    });

    for (i = 0; i < gpuArray.length; i++) {
      a = gpuArray[i].getElementsByTagName('a')[0];
      txtValue = a.textContent || a.innerText;
      price = parseFloat(gpuArray[i].querySelector('p').textContent.replace('RM ', ''));

      if (
        txtValue.toUpperCase().indexOf(filter) > -1 &&
        price >= minPrice &&
        price <= maxPrice
      ) {
        gpuArray[i].style.display = '';
      } else {
        gpuArray[i].style.display = 'none';
      }

      ul.appendChild(gpuArray[i]); // Reorder the elements in the DOM
    }
  }
</script>

<style>
  #testingcss {
  display: block;
}

#testingcss input,
#testingcss button {
  display: block;
  margin-bottom: 10px; /* Add spacing between elements */
}
</style>

{% endblock %}
