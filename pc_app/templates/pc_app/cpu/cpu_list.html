{% extends 'pc_app/base.html' %}
{% block title %}{{ cpu.name }}{% endblock %}
{% block content %}
{% load custom_filters %}

<div class="col-sm-12">
  <div class="titleheader">
    <h3 class="h2header text-center">CPU ({{ cpus|length }})</h3>
    <!-- <a href="#" id="sortToggle" onclick="toggleSorting()">Sort A to Z</a> -->
    <form method="get" action="{% url 'cpu_list' %}">
      <label for="search_query">CPU Model:</label>
      <input type="text" name="search_query" placeholder="Search CPU Model...">
    <!-- <input type="number" name="min_clock_speed" id="min_clock_speed" step="0.01" min="0" style="width: 50px;" placeholder="Speed">
    
    <input type="number" name="min_core_count" id="min_core_count" min="1" style="width: 50px;" placeholder="Cores..."> -->

    <input type="number" name="min_price" id="min_price" min="1" style="width: 100px;" placeholder="Min Price">
    <input type="number" name="max_price" id="max_price" min="1" style="width: 100px;" placeholder="Max Price">

      <button type="submit"><span class="fas fa-search"></span></button>
      <button type="button" onclick="resetSearch()">Reset</button>
    </form>
  </div>

  <div class="pagination">
    <span class="step-links">
      {% if page_obj.has_previous %}
      <a href="?page=1">&laquo; First</a>
      <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
      {% endif %}
  
      <span class="current-page">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
      </span>
  
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">Next</a>
      <a href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
      {% endif %}
    </span>
  </div>
  
  <div id="cpuList" style="max-width: 1100px;"> <!-- Add id="cpuList" to the container div -->
    <div class="component-row">
      {% for cpu in page_obj %}
      <div class="component-box text-center">
        <a href="{% url 'cpu_detail' cpu.pk %}">
          <div class="coverpage">
            {% if cpu.name|lower|slice:"0:3" == "amd" %}
            <img src="https://www.amd.com/system/files/2020-06/amd-default-social-image-1200x628.jpg" width="110"
              height="100"> <!-- Replace with the actual path to AMD image -->
            {% elif cpu.name|lower|slice:"0:5" == "intel" %}
            <img src="https://www.intel.com/content/dam/logos/logo-energyblue-1x1.png" width="100" height="100">
            <!-- Replace with the actual path to Intel image -->
            {% else %}
            <img src="default-image.png"> <!-- Add a default image path if needed -->
            {% endif %}
          </div>
          <p><a href="{% url 'cpu_detail' cpu.pk %}">{{ cpu.name }}</a></p>
          <p>${{ cpu.price|convert_to_myr }}</p>
          <button class="select-button" onclick="selectComponent('cpu', '{{ cpu.id }}')"><span class="fas fa-cog"></span> Select</button>

      </div>
      {% if forloop.counter|divisibleby:5 and not forloop.last %} <!-- Create a new row after every 5 CPUs -->
    </div>
    <div class="component-row">
      {% endif %}
      {% endfor %}
    </div>
  </div>

  <script>
    var ascending = true;

    function toggleSorting() {
      ascending = !ascending;
      var sortDirection = ascending ? 'name' : '-name';
      document.getElementById('sortToggle').innerText = ascending ? 'Sort A to Z' : 'Sort Z to A';
      var url = window.location.href.split('?')[0] + '?sort_by=' + sortDirection;
      window.location.href = url;
    }


    function resetSearch() {
      document.querySelector('input[name="search_query"]').value = '';
      document.querySelector('form').submit();
    }
  </script>

  {% endblock %}